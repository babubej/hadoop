<workflow-app name="core_${feedName}" xmlns="uri:oozie:workflow:0.4">
    <start to="core_item_loc_combined_fact"/>
    <action name="core_item_loc_combined_fact">
        <pig>
            <job-tracker>${jobTracker}</job-tracker>
            <name-node>${nameNode}</name-node>
            <prepare>
                <delete path="${wfOutput}"/>
            </prepare>
            <configuration>
                <property>
                    <name>mapreduce.job.name</name>
                    <value>Core-${feedName}</value>
                </property>
                <property>
                    <name>mapreduce.job.queuename</name>
                    <value>${queueName}</value>
                </property>
                <property>
                    <name>mapred.max.split.size</name>
                    <value>268435456</value>
                </property>
                <property>
                    <name>mapred.compress.map.output</name>
                    <value>true</value>
                </property>
                <property>
                    <name>oozie.action.external.stats.write</name>
                    <value>true</value>
                </property>
            </configuration>
            <script>pig/${feedName}.pig</script>
            <argument>-param</argument>
            <argument>INPUT_RP_FACT_PATH=${wfInputRp}</argument>
            <argument>-param</argument>
            <argument>INPUT_RPL_FACT_PATH=${wfInputRpl}</argument>
            <argument>-param</argument>
            <argument>OUTPUT_PATH=${wfOutput}</argument>
            <argument>-param</argument>
            <argument>NEXT_DAY_DATE_STAMP=${nextDayDateStamp}</argument>
            <argument>-param</argument>
            <argument>DATE_STAMP=${dateStamp}</argument>
            <argument>-param</argument>
            <argument>PREV_DAY_DATE_STAMP=${prevDayDateStamp}</argument>
            <argument>-param</argument>
            <argument>ACE_CORE_JAR=${wfAppPath}/lib/ace-core-1.1.jar</argument>
        </pig>
        <ok to="end"/>
        <error to="failure_email"/>
    </action> 
    <!--
    <action name="core_item_loc_combined_fact_shell">
        <shell xmlns="uri:oozie:shell-action:0.1">
            <job-tracker>${jobTracker}</job-tracker>
            <name-node>${nameNode}</name-node>
            <prepare>
                <delete path="${wfOutput}"/>
            </prepare>
            <configuration>
                <property>
                    <name>mapreduce.job.name</name>
                    <value>Core-${feedName}</value>
                </property>
                <property>
                    <name>mapreduce.job.queuename</name>
                    <value>${queueName}</value>
                </property>
            </configuration>
            <exec>trigger_pig_item_loc_fact.sh</exec>
            <argument>INPUT_RP_FACT_PATH=${wfInputRp}</argument>
            <argument>INPUT_RPL_FACT_PATH=${wfInputRpl}</argument>
            <argument>OUTPUT_PATH=${wfOutput}</argument>
            <argument>NEXT_DAY_DATE_STAMP=${nextDayDateStamp}</argument>
            <argument>DATE_STAMP=${dateStamp}</argument>
            <argument>PREV_DAY_DATE_STAMP=${prevDayDateStamp}</argument>
            <argument>ACE_CORE_JAR=./ace-core-1.1.jar</argument>
            <argument>${wfAppPath}/pig/item_loc_combined_fact.pig</argument>
            <argument>item_loc_combined_fact.pig</argument>
            <file>scripts/trigger_pig_item_loc_fact.sh#trigger_pig_item_loc_fact.sh</file>
            <file>pig/item_loc_combined_fact.pig#item_loc_combined_fact.pig</file>
            <file>${wfAppPath}/lib/ace-core-1.1.jar#ace-core-1.1.jar</file>
        </shell>
        <ok to="end"/>
        <error to="end"/>
    </action>
    -->
    <action name="failure_email">
        <shell xmlns="uri:oozie:shell-action:0.1">
            <job-tracker>${jobTracker}</job-tracker>
            <name-node>${nameNode}</name-node>
            <exec>AceFailureAlert.sh</exec>
            <argument>${jobFailureEmails}</argument>
            <argument>${wf:id()}</argument>
            <argument>${wf:errorMessage(wf:lastErrorNode())}</argument>
            <argument>${wf:actionExternalId(wf:lastErrorNode())}</argument>
            <argument>${hostName}</argument>
            <file>./scripts/AceFailureAlert.sh#AceFailureAlert.sh</file>
        </shell>
        <ok to="kill"/>
        <error to="kill"/>
    </action>
    <!--
    <action name="failure_email">
        <email xmlns="uri:oozie:email-action:0.1">
            <to>visagan.vaithyanathan@target.com</to>
            <subject>ACE CORE JOB FAILURE ${wf:id()}</subject>
            <body>
              Error message is: [${wf:errorMessage(wf:lastErrorNode())}]
              Oozie job id: ${wf:id()}
              This is an automatic e-mail generated by the job.
            </body>
        </email>
        <ok to="kill"/>
        <error to="kill"/>
    </action>
    -->
    <kill name="kill">
        <message>Action failed, error message[${wf:errorMessage(wf:lastErrorNode())}]</message>
    </kill>
    <end name="end"/>
</workflow-app>
